<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title></title>
    <!-- head 中 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="__PUBLIC__/css/main.css">
</head>

<body>
    <div class="page home ">
        <div class="page__hd">
            <h1 class="page__title">
                人物详情
            </h1>
        </div>
        <input type="hidden" id="person_id" value="{$person.id}">
        <div class="page__bd page__bd_spacing ">
            <div class="sd bgw">
                <div class="mainflex js_category">

                    <div class="mainphoto c1">
                        <!-- 头像 -->
                        <img src="{$person.person_img}" alt="">
                    </div>
                    <div class="maintext">
                        <ul>
                            <input hidden id="id" value="{$id}">
                            <li class="dark">等级:
                                <span>{$person.level}</span>
                            </li>
                            <li class="dark">基础挖矿属性:
                                <span>{$person.person_capacity}</span>
                            </li>
                            <li class="dark">成长属性:
                                <span>{$person.person_property}</span>
                            </li>
                            <li class="dark">血量:
                                <span>{$person.blood}</span>
                            </li>

                            <li class="dark">总算力:
                                <span>{$person.capacity}</span>
                            </li>
                        </ul>
                    </div>

                    <div class="cleanfix"></div>
                </div>
                <div class="zbmain">
                    <div class="weui-tab">
                        <div class="weui-navbar">
                            <if condition="$m eq '1'">
                                <a class="weui-navbar__item " href="#tab1">
                                    装备
                                </a>
                                <a class="weui-navbar__item weui-bar__item--on" href="#tab2">
                                    药品
                                </a>
                                <else />

                                <a class="weui-navbar__item weui-bar__item--on" href="#tab1">
                                    装备
                                </a>
                                <a class="weui-navbar__item " href="#tab2">
                                    药品
                                </a>

                            </if>


                            <a class="weui-navbar__item" href="#tab3">
                                掘金记录
                            </a>
                        </div>
                        <div class="weui-tab__bd">
                            <if condition="$m eq 1">
                                    <div id="tab1" class="weui-tab__bd-item ">
                                    <else />
                                    <div id="tab1" class="weui-tab__bd-item  weui-tab__bd-item--active">
                            </if>


                                <div class="stitle mb15">当前装备</div>
                                <div class="weui-flex mb5 flexcenter" data-id="{$person.equipment_info.id}">
                                    <div class="">
                                        <div class="item c1" style="margin-right:15px">

                                            <if condition="$person.equipment_info eq ''">
                                                <img src="/public/images/nullzhuangbei.png" alt="" >
                                                <else />
                                                <img src="{$person.equipment_info.equipment_img}" alt="" >
                                            </if>

                                        </div>
                                    </div>
                                    <if condition="$person.equipment_info eq ''">
                                        <div class="weui-flex__item itemname f12 dark">
                                            <div class="itemname  f12">没有装备</div>
                                            <div></div>
                                        </div>
                                        <else />
                                        <div class="weui-flex__item f12 dark">
                                        <div class="itemname black f12">{$person.equipment_info.equipment_name}</div>
                                        <div>耐久度：{$person.equipment_info.equipment_endurance}</div>
                                        </div>
                                    </if>

                                </div>
                                <div class="weui-flex mb10 flexcenter"  data-id="{$person.equipment_card_info.id}">
                                    <div class="">
                                        <div class="item c1" style="margin-right:15px">
                                            <if condition="$person.equipment_card_info eq ''">
                                                <img src="/public/images/nullzhuangbei.png" alt="" >
                                                <else />
                                                <img src="{$person.equipment_card_info.equipment_img}" alt="" >
                                            </if>
                                        </div>
                                    </div>
                                    <if condition="$person.equipment_card_info eq ''">
                                       
                                        <div class="weui-flex__item itemname f12 dark">
                                            <div class="itemname  f12">没有装备</div>
                                            <div></div>
                                        </div>
                                        <else/>
                                        <div class="weui-flex__item f12 dark">
                                        <div class="itemname black f12">{$person.equipment_card_info.equipment_name}</div>
                                        <div>已装备</div>
                                        </div>
                                    </if>


                                </div>
                                <div class="cleanfix"></div>
                                <hr>
                                <div class="stitle mt15 mb15">可用装备</div>
                                <div>
                                    <ul class="flex-layout category-head" id="category-head" style="">
                                        <volist name="equipment_all" id="vo">
                                            <li class="flex" style="" searchtype="brand">
                                                <div class="omreitem c1 usezb" data-id="{$vo.id}">
                                                    <img src="{$vo.equipment_img}" alt="">
                                                </div>
                                                <div class="weui-flex__item itemname  f12 black mt5">{$vo.equipment_name} </div>
                                                <if condition="$vo.equipment_protect neq 0">
                                                    <div class="weui-flex__item itemname f12 dark">此道具无耐久属性</div>

                                                    <else />
                                                    <div class="weui-flex__item itemname f12 dark">耐久度：{$vo.equipment_endurance}</div>
                                                </if>
                                            </li>
                                        </volist>

                                    </ul>

                                </div>
                            </div>
                            <if condition="$m eq 1">
                                <div id="tab2" class="weui-tab__bd-item weui-tab__bd-item--active">
                                <else />
                                <div id="tab2" class="weui-tab__bd-item ">
                            </if>

                                <!--<div class="stitle mb15">血量</div>-->
                                <!--<div class="progress">-->
                                    <!--<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"-->
                                        <!--style="width:80%">-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!--<div class="pull-right stitle mt5 mb15">当前血量：0</div>-->
                                <!--<div class="cleanfix"></div>-->
                                <!--<hr>-->

                                <div class="stitle mt15 mb15">我的食物</div>
                                <div class="mb15 mt15">
                                    <ul class="flex-layout category-head" id="category-head" style="">
                                        <!--<li class="flex" style=""  searchtype="brand">-->
                                            <!--<div class="omreitem c1">-->
                                                <!--<img src="http://placehold.it/300x300" alt="">-->
                                            <!--</div>-->
                                            <!--<div class="weui-flex__item itemname  f12 black mt5">大铁锤 </div>-->
                                            <!--<div class="weui-flex__item itemname f12 dark">耐久度：7</div>-->
                                        <!--</li>-->

                                        <volist name="mediche_all" id="vo">
                                            <li class="flex" style="" searchtype="brand">
                                                <div class="omreitem c1 use" data-id="{$vo.id}">
                                                    <img src="{$vo.mediche_img}" alt="">
                                                    <input value="{$vo.id}" class="id" type="hidden">
                                                    <input value="2" class="type" type="hidden">
                                                </div>
                                                <div class="weui-flex__item itemname  f12 black mt5">{$vo.mediche_name} </div>
                                                <div class="weui-flex__item itemname f12 dark">数量:{$vo.mediche_num}</div>
                                            </li>
                                        </volist>
                                    </ul>
                                    <div class="cleanfix"></div>
                                </div>
                                <hr>
                                <div class="stitle mt15 mb15">喂养记录</div>
                                <table class="table table-striped">
                                    <tbody>
                                    <volist name="log" id="vo">
                                        <tr>
                                           
                                            <td class="green" style="text-align: left;"><div class="dark">{:date('Y-m-d H:i:s',$vo['time'])}</div>{$vo.msg}</td>
                                        </tr>
                                    </volist>
                                    </tbody>
                                </table>
                            </div>
                            <div id="tab3" class="weui-tab__bd-item">
                                <!-- 通用无数据 -->
                               <!--  <div class="text-center dark f12 pb20">
                                    <div class="f14"><i class="fa fa-thermometer-empty"></i></div>
                                    暂无数据
                                </div> -->
                                <table class="table table-striped">
                                    <tbody>
                                        <tr>
                                            <td scope="row">2010-01-08 23:53:21</td>
                                            <td>/</td>
                                            <td class="green">+12 wkc</td>
                                        </tr>
                                        <tr>
                                            <td scope="row">2010-01-08 23:53:21</td>
                                            <td>/</td>
                                            <td class="green">+12 wkc</td>
                                        </tr>
                                        <tr>
                                            <td scope="row">2010-01-08 23:53:21</td>
                                            <td>/</td>
                                            <td class="green">+11 wkc</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sd bgw mt15 p20">
                <div class="stitle">操作</div>
                <div class="weui-flex">
                    <div class="weui-flex__item text-center">
                        <button id="sell" class="weui-btn  weui-btn_warn  mt10 mb10">出售角色</button>
                    </div>
                </div>
            </div>
        </div>


        <div class="footheight"></div>
         <div class="weui-tabbar">
            <a href="{:U('bag/person')}" class="weui-tabbar__item weui-bar__item--on">
                <div class="weui-tabbar__icon">
                    <i class="fa fa-gamepad"></i>
                </div>
                <p class="weui-tabbar__label">背包</p>
            </a>
            <a href="{:U('store/person')}" class="weui-tabbar__item">
                <div class="weui-tabbar__icon">
                    <i class="fa fa-shopping-bag"></i>
                </div>
                <p class="weui-tabbar__label">商城</p>
            </a>
            <a href="{:U('putorder/orderList','','')}/commodity_type/1/type/1" class="weui-tabbar__item">
                <div class="weui-tabbar__icon">
                    <i class="fa fa-gavel"></i>
                </div>
                <p class="weui-tabbar__label">交易</p>
            </a>
            <a href="{:U('bag/userMe')}" class="weui-tabbar__item ">
                <div class="weui-tabbar__icon">
                    <i class="fa fa-user"></i>
                </div>
                <p class="weui-tabbar__label">我的</p>
            </a>
        </div>
    </div>

   
    <!-- body 最后 -->
    <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
    <!-- 如果使用了某些拓展插件还需要额外的JS -->
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/swiper.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/city-picker.min.js"></script>
    <script>

        $(document).on("click", "#sell", function () {
            var that = this;

            $.confirm({
                title: '',
                text: '若人物绑定装备则会携带装备出售，是否继续?',
                onOK: function () {
                    //点击确认
                    $.prompt({
                        title: '请输入在交易中心挂单价格',
                        input: '',
                        empty: false, // 是否允许为空
                        onOK: function (input) {
                            var input = input;
                             var strP=/^\d+(\.\d+)?$/;
 								if(!strP.test(input)) {
 								
                            	$.alert("请输入数字");
                                result(false)
                            }
                            if (input=='0') {
                                $.alert("出售价格不能为0");
                                result(false)
                            }

                            $.confirm({
                              title: '出售提示',
                              text: '确定以'+input+'wkc价格出售该人物?',
                              onOK: function () {
                                   $.ajax({
                                url:"{:U('putorder/sellCreationOrder')}",
                                type:'POST', //GET
                                async:true,    //或false,是否异步
                                data:{
                                    commodity_type:1,
                                    commodity_id :$('#person_id').val(),
                                    commodity_price :input
                                },
                                timeout:5000,    //超时时间
                                dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                                success:function(result){
                                    if (result.status) {
                                        alert('挂单成功，若有用户购买则会以短信的方式通知您!');
                                        window.location.href= "{:U('bag/userMe','','')}";
                                    } else {
                                        alert(result.msg);

                                    }

                                }
                            })
                                //点击确认
                              },
                              onCancel: function () {
                              }
                            });
                         

                        },
                        onCancel: function () {
                            //点击取消
                        }
                    });
                    //$(that).parents("li").remove()
                },
                onCancel: function () {
                }
            });
        });//使用道具

          $(document).on("click", ".use", function () {
                var that = this;
              var mediche = $(this).data('id');
                $.confirm({
                  title: '',
                  text: '确定使用?',
                  onOK: function () {
                      //点击确认
                     
                      //$(that).parents("li").remove()
                      $.ajax({
                          url:"{:U('bag/useMediche')}",
                          type:'POST', //GET
                          async:true,    //或false,是否异步
                          data:{
                              mediche_bag_id:mediche,
                              person_bag_id:$('#person_id').val()
                          },
                          timeout:5000,    //超时时间
                          dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                          success:function(result){
                              if (result.status) {

                              } else {
                                  alert(result.msg);

                              }
                              window.location.href="{:U('bag/personDetails','','')}/id/{$person.id}/m/1";
                          }
                      })
                  },
                  onCancel: function () {
                  }
              });
            });//使用道具

          $(document).on("click", ".usezb", function () {
                var that = this;
              var equipment_bag_id = $(this).data('id');
                $.confirm({
                  title: '',
                  text: '确定使用?',
                  onOK: function () {

                      //点击确认
                     
                       //$(that).parents("li").remove();

                      $.ajax({
                          url:"{:U('bag/switchover')}",
                          type:'POST', //GET
                          async:true,    //或false,是否异步
                          data:{
                              equipment_bag_id:equipment_bag_id,
                              type:1,
                              person_bage_id:$('#person_id').val()
                          },
                          timeout:5000,    //超时时间
                          dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                          success:function(result){
                              if (result.status) {
                                  window.location.reload();
                              } else {
                                  alert(result.msg);
                                  window.location.reload();
                              }
                          }
                      })
                      
                  },
                  onCancel: function () {
                  }
              });
            });//使用装备

          $(document).on("click", ".flexcenter", function () {
                var that = this;
              var equipment_bag_id = $(this).data('id');
                $.confirm({
                  title: '',
                  text: '卸下装备?',
                  onOK: function () {
                      //点击确认
                      $.ajax({
                          url:"{:U('bag/switchover')}",
                          type:'POST', //GET
                          async:true,    //或false,是否异步
                          data:{
                              equipment_bag_id:equipment_bag_id,
                              type:0,
                              person_bage_id:$('#person_id').val()
                          },
                          timeout:5000,    //超时时间
                          dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                          success:function(result){
                              if (result.status) {
                                  window.location.href="{:U('bag/personDetails','','')}/id/{$person.id}";
                              } else {
                                  alert(result.msg);
                                  window.location.href="{:U('bag/personDetails','','')}/id/{$person.id}";
                              }
                          }
                      })
//                       $(that).html(
// '<div class=""><div class="item c1" style="margin-right:15px"><img src="/public/images/nullzhuangbei.png" alt="" ></div></div><div class="weui-flex__item itemname f12 dark"><div class="itemname  f12">没有装备</div><div></div></div>'
//                         )
                      
                  },
                  onCancel: function () {
                  }
              });
            });//卸下
    </script>
</body>

</html>